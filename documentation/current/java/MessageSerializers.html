
<!DOCTYPE html>
<html class="noios">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Lagom - Message serializers</title>
        <meta name="description" content="Lagom">
        
            <link rel="canonical" href="https://www.lagomframework.com/documentation/1.6.x/java/MessageSerializers.html"/>
        
        <meta name="viewport" content="width=device-width,maximum-scale=1"/>
        <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700" rel="stylesheet" type="text/css"/>
        <link rel="stylesheet" href="/94dac49075b4ec3a86dd12848be6c2286ed80149-all-styles-concat.css" type="text/css">
        <!-- OneTrust Cookies Consent Notice (Production Standard, lagomframework.com, en-GB) start -->
        <script src="https://optanon.blob.core.windows.net/consent/1ee3f0d6-9ed5-4b9e-bed7-ce6faaeaca5d.js" type="text/javascript" charset="UTF-8"></script>
        <script type="text/javascript">
            function OptanonWrapper() { 
                (function($) {
                    $(function() {
                        //find each YT embed and only load if cookies have been approved
                        $( ".yt-widget" ).each(function( index ) {
                            var ytID = $(this).attr("id").slice(3);
                            Optanon.InsertHtml('<iframe id="player" class="youtube-embed-player" src="//www.youtube.com/embed/'+ytID+'?rel=0&amp;autohide=1&amp;modestbranding=0&amp;showinfo=1" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>', 'yt-'+ytID, null, {deleteSelectorContent: true}, 4);
                        });
                    });
                })(jQuery);
            }
        </script>
        <!-- OneTrust Cookies Consent Notice (Production Standard, lagomframework.com, en-GB) end -->
         
    <link rel="stylesheet" href="//cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" />
    

    </head>
    <body>
        <div class="off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>
                <div class="off-canvas position-left" id="offCanvasLeft" data-off-canvas >
                    <nav>
                        <button class="close-button" aria-label="Close menu" type="button" data-close>
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <a href="/get-started.html">Try Lagom</a>
                        
<h3>Documentation</h3>
<ul>
    <li><a href="/documentation">By release</a></li>
    <li><a href="/faq.html">FAQ</a></li>
    <li><a href="/blog">Team Blog</a></li>
</ul>
<h3>Find Help</h3>
<ul>
    <li><a href="https://gitter.im/lagom/lagom">Gitter channel</a></li>
    <li><a href="https://stackoverflow.com/questions/tagged/lagom">Stack overflow</a></li>
    <li><a href="/support.html">Support</a></li>
</ul>
<h3>Contribute</h3>
<ul>
    <li><a href="/get-involved.html">Get involved</a></li>
    <li><a href="https://www.lightbend.com/conduct">Code of conduct</a></li>
    <li><a href="/community-process.html">Community process</a></li>
    <li><a href="/contributing.html">Contributor guidelines</a></li>
</ul>
<!-- <h3>Programs</h3> Commented out Oct 2017 because the team is not participating in this round of the program.
<ul>
    <li><a href="/outreachy/round14.html">Outreachy</a></li>
</ul> -->

                    </nav>
                </div>
                <div class="off-canvas-content" data-off-canvas-content>

                    
<div id="lightbend-banner" class="lightbend-banner lagom full-width" data-category="OSS Lightbend Banner Impression" data-label="Lagom Banner Impression">
	<div class="wrapper">
		<div class="brand">
			<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Lagom Banner" href="https://www.lightbend.com?r=oss-banner-lagom" target="_blank">
				<img class="lightbend-logo" src="/images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
			</a>
		</div>
		<div class="nav">
			<a class="banner-btn oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Enhance your Lagom services with Akka Platform [Button] - Lagom Banner" href="https://www.lightbend.com/lagom-framework-part-of-akka-platform?r=oss-banner-lagom" target="_blank">
				<span>Enhance your Lagom services with</span>
				<img class="akka-platform-reverse-logo" src="/images/banner-logos/akka-platform-reverse.svg" alt="Akka Platform" title="Akka Platform">
			</a>
			<div class="drop-down">
				<svg class="svg-chevon-circle-down" version="1.1" id="Chevron_circled_down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
					<path fill="#ffffff" d="M12.505,8.698L10,11L7.494,8.698c-0.198-0.196-0.518-0.196-0.718,0c-0.197,0.196-0.197,0.515,0,0.71l2.864,2.807
					c0.199,0.196,0.52,0.196,0.717,0l2.864-2.807c0.199-0.195,0.198-0.514,0-0.71C13.024,8.502,12.704,8.502,12.505,8.698z M10,0.4
					c-5.302,0-9.6,4.298-9.6,9.6c0,5.303,4.298,9.6,9.6,9.6s9.6-4.297,9.6-9.6C19.6,4.698,15.302,0.4,10,0.4z M10,18.354
					c-4.615,0-8.354-3.74-8.354-8.354c0-4.614,3.739-8.354,8.354-8.354c4.613,0,8.354,3.74,8.354,8.354
					C18.354,14.614,14.613,18.354,10,18.354z" />
				</svg>
				<div class="drop-down-content">
					<div class="lightbend-family">
						<a href="https://akka.io" class="akka oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Akka - Logo Tag Line - Lagom Banner">
							<img class="akka-full-color-logo" src="/images/banner-logos/akka-full-color.svg" alt="Akka by Lightbend" title="Akka by Lightbend">
						</a>
						<a href="https://cloudflow.io" class="cloudflow oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudflow - Logo Tag Line - Lagom Banner">
							<img class="cloudflow-full-color-logo" src="/images/banner-logos/cloudflow-full-color.svg" alt="Cloudflow by Lightbend" title="Cloudflow by Lightbend">
						</a>
						<a href="https://cloudstate.io" class="cloudstate oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Cloudstate - Logo Tag Line - Lagom Banner">
							<img class="cloudstate-full-color-logo" src="/images/banner-logos/cloudstate-full-color.svg" alt="Cloudstate by Lightbend" title="Cloudstate by Lightbend">
						</a>
						<a href="https://www.playframework.com" class="play oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Play - Logo Tag Line - Lagom Banner">
							<img class="play-full-color-logo" src="/images/banner-logos/play-full-color.svg" alt="Play Framework by Lightbend" title="Play Framework by Lightbend">
						</a>
						<a href="https://www.scala-lang.org" class="scala oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Scala - Logo Tag Line - Lagom Banner">
							<img class="scala-full-color-logo" src="/images/banner-logos/scala-full-color.svg" alt="Scala by Lightbend" title="Scala by Lightbend">
						</a>
						<div class="lagom current">
							<img class="lagom-full-color-logo" src="/images/banner-logos/lagom-full-color.svg" alt="Lagom Framework by Lightbend" title="Lagom Framework by Lightbend">
							<span>From the creators of <strong>Lagom</strong>, get technology enhancements, monitoring, and expert support with Akka Platform from Lightbend.</span>
							<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Learn More [Button] - Lagom Banner" href="https://www.lightbend.com/lagom-framework-part-of-akka-platform?r=oss-banner-lagom" target="_blank">Learn More</a>
						</div>
					</div>
					<div class="title">The Lightbend Family</div>
				</div>      
			</div>
		</div>
	</div>
</div>

                    <header class="navbar">
                        <div class="row">
                            <div class="small-12 columns">
                                <button class="menu-icon hide-for-medium" type="button" data-open="offCanvasLeft" data-toggle="offCanvas"></button>
                                <a class="logo" href="/"><svg id="Lagom_Full_Color" class="svg-logo svg-logo-lagom-full-color" data-name="Lagom Full Color" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 752 192"><title>logom</title><g id="Lagom"><path d="M291.58,31.79h19.83v87.91c0,8.1,2.64,11.57,9.91,11.57a21.11,21.11,0,0,0,5.95-.66V148.3a35.63,35.63,0,0,1-9.42,1c-17.52,0-26.28-8.92-26.28-26.94V31.79Z" fill="#652b7c"/><path d="M398.34,75.75V63.69h19.83v58.17c0,7.11,1.65,9.75,6.11,9.75a41.28,41.28,0,0,0,4.13-.33v16a28.65,28.65,0,0,1-9.75,1.32c-4.79,0-8.59-.83-11.57-2.64a15.33,15.33,0,0,1-6.78-10.08C394.53,144.66,385,149,371.73,149A39.58,39.58,0,0,1,342,136.4c-7.93-8.43-11.9-18.67-11.9-31.07s4-22.64,11.9-30.9a39.58,39.58,0,0,1,29.75-12.56C385.12,61.87,395.2,67.82,398.34,75.75Zm-5.95,47.76a24.29,24.29,0,0,0,7.44-18.18,24.29,24.29,0,0,0-7.44-18.18,24.68,24.68,0,0,0-18-7.27,23.93,23.93,0,0,0-17.68,7.27c-4.63,4.79-6.94,10.91-6.94,18.18s2.31,13.39,6.94,18.18a23.93,23.93,0,0,0,17.68,7.27A24.68,24.68,0,0,0,392.39,123.51Z" fill="#652b7c"/><path d="M495.67,63.69H515.5v69.41c0,20-2.81,32.23-14,41-7.93,6.11-17.68,9.25-29.42,9.25-15.53,0-28.92-4-40.32-12.06l9.59-14.71a50.47,50.47,0,0,0,28.59,9.09q11.65,0,18.34-5c5.29-3.8,7.93-10.91,7.93-21.15v-4.13c-4,7.11-13.88,12.23-27.1,12.23a40.53,40.53,0,0,1-29.75-12.23c-7.93-8.1-11.9-18.34-11.9-30.41s4-22.31,12.06-30.57a39.23,39.23,0,0,1,29.58-12.56c13.72,0,23.8,5.78,26.61,13.88V63.69ZM489.72,123a24.19,24.19,0,0,0,7.44-18,23.82,23.82,0,0,0-7.44-17.85,24.68,24.68,0,0,0-18-7.27A23.93,23.93,0,0,0,454,87.15,24.69,24.69,0,0,0,447.09,105,25.08,25.08,0,0,0,454,123a23.79,23.79,0,0,0,17.68,7.11C478.81,130.12,484.93,127.81,489.72,123Z" fill="#652b7c"/><path d="M522.44,105.33a42.05,42.05,0,0,1,13.22-31.4c8.76-8.43,19.5-12.72,32.22-12.72s23.47,4.3,32.23,12.72a42.05,42.05,0,0,1,13.22,31.4,42.05,42.05,0,0,1-13.22,31.4c-8.76,8.43-19.5,12.72-32.23,12.72s-23.47-4.3-32.22-12.72A42.05,42.05,0,0,1,522.44,105.33ZM586.23,124a25.67,25.67,0,0,0,7.44-18.67,25,25,0,0,0-7.44-18.51,26.13,26.13,0,0,0-36.85,0,25.56,25.56,0,0,0-7.27,18.51A26.22,26.22,0,0,0,549.38,124,26.54,26.54,0,0,0,586.23,124Z" fill="#652b7c"/><path d="M620.6,147V63.69h19.67v11.9C643.74,67.49,652,62,662.58,62,674,62,681.91,66.83,686,76.58,690.84,66.83,699.76,62,712.81,62c18,0,28.42,12.72,28.42,33.38v26.28c0,6.44,1.16,8.76,5.62,8.76a14.56,14.56,0,0,0,2.81-.33v16.69a28.37,28.37,0,0,1-8.59,1c-13.05,0-19.5-7.27-19.5-21.81V98.23c0-11.4-5.29-18.51-14.54-18.51s-16,8.1-16,19.33V147H671.34V98.23c0-11.4-5.45-18.51-14.87-18.51-9.25,0-16.2,8.1-16.2,19.33V147H620.6Z" fill="#652b7c"/></g><g id="Icon"><path d="M261,84l-70,34,70,34S260.78,84.27,261,84Z" fill="#652b7c"/><polygon points="121 152 191 118 121 84 121 152" fill="#652b7c"/><path d="M191,118l70,34c-0.27,0-41.76,25-60.63,36.24a17.64,17.64,0,0,1-18,0C163.47,177,121,152,121,152Z" fill="#421540"/><path d="M200.23,47.65C219.09,58.88,261,84,261,84l-70,34L121,84c0.27,0,42.31-25.12,61.18-36.36A17.64,17.64,0,0,1,200.23,47.65Z" fill="#bf97c6"/><path d="M145,20.58l-35,17,35,17S144.89,20.72,145,20.58Z" fill="#652b7c"/><polygon points="75 54.58 110 37.58 75 20.58 75 54.58" fill="#652b7c"/><path d="M110,37.58l35,17c-0.14,0-20.88,12.5-30.31,18.12a8.82,8.82,0,0,1-9,0C96.23,67.08,75,54.58,75,54.58Z" fill="#421540"/><path d="M114.61,2.4C124,8,145,20.58,145,20.58l-35,17-35-17C75.14,20.59,96.16,8,105.59,2.4A8.82,8.82,0,0,1,114.61,2.4Z" fill="#bf97c6"/><path d="M101,91L51,115.54l50,24.53S100.84,91.21,101,91Z" fill="#652b7c"/><polygon points="1 140.07 51 115.54 1 91.02 1 140.07" fill="#652b7c"/><path d="M51,115.54l50,24.53c-0.19,0-29.83,18-43.3,26.14a12.5,12.5,0,0,1-12.89,0C31.34,158.1,1,140.07,1,140.07Z" fill="#421540"/><path d="M57.59,64.79C71.06,72.9,101,91,101,91L51,115.54,1,91C1.19,91,31.22,72.9,44.7,64.79A12.5,12.5,0,0,1,57.59,64.79Z" fill="#bf97c6"/></g></svg></a>
                                <nav class="sections show-for-medium">
                                    
<a href="/get-started.html">Try Lagom</a>
<a href="/documentation/">Documentation</a>
<a href="/faq.html">FAQ</a>
<a href="/support.html">Support</a>
<a href="/get-involved.html">Get Involved</a>
<a href="/blog/">Blog</a>

                                </nav>
                            </div>
                        </div>
                    </header>
                    <div class="fw-wrapper flush sticky-bar">
                        <div class="row">
                            <div class="small-12 columns">
                                <div class="small-menu">
                                    <button class="menu-icon" type="button" data-open="offCanvasLeft" data-toggle="offCanvas"></button>
                                    <a class="logo" href="/"><span></span></a>
                                    <nav class="sections-scroll">
                                        
<a href="/get-started.html">Try Lagom</a>
<a href="/documentation/">Documentation</a>
<a href="/faq.html">FAQ</a>
<a href="/support.html">Support</a>
<a href="/get-involved.html">Get Involved</a>
<a href="/blog/">Blog</a>

                                    </nav>
                                    <nav class="social">
                                        <a href="https://discuss.lagomframework.com"><span>Discuss Lagom</span></a>
                                        <a href="https://twitter.com/lagom"><span>Twitter</span></a>
                                        <a href="https://github.com/lagom/lagom"><span>GitHub</span></a>
                                        <a href="https://stackoverflow.com/questions/tagged/lagom"><span>Stack Overflow</span></a>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>

                     
    <header class="fw-wrapper lgm-purple page-title">
        <div class="row">
            <div class="small-12 columns">
                <h1>Message serializers</h1>
            </div>
        </div>
    </header>

    <div class="fw-wrapper documentation-content">
        <div class="row">
            <div class="small-12 large-7 columns">
                
                    <nav class="breadcrumbs">
                        <a href="Home.html">Java Home</a>
                        
                                    &raquo;
                            <a href="ReferenceGuide.html">Lagom reference guide</a>
                        
                                    &raquo;
                            <a href="ServiceDescriptors.html">Writing Lagom services</a>
                        
                    </nav>
                

                <article>
                <h1 id="Message-Serializers"><a class="section-marker" href="#Message-Serializers">§</a>Message Serializers</h1>
<p>Out of the box, Lagom uses Jackson to serialize request and response messages. However, you can define custom serializers on a per service call basis, as well register a serializer for a given type for the whole service, and finally you can also customize the serialization factory used by Lagom to completely change the serializers Lagom uses when no serializer is selected.</p><h2 id="How-Lagom-selects-a-message-serializer"><a class="section-marker" href="#How-Lagom-selects-a-message-serializer">§</a>How Lagom selects a message serializer</h2>
<p>Lagom uses a three step process to select a message serializer for a service call.</p><h3 id="Per-service-call-message-serializers"><a class="section-marker" href="#Per-service-call-message-serializers">§</a>Per service call message serializers</h3>
<p>Lagom first checks whether a specific message serializer has been defined on the service call. By default, each service call defers the decision for request and response message serializers to the next level up, but a custom serializer can be specified for a specific service call request or response, using the <a href="api/index.html?com/lightbend/lagom/javadsl/api/Descriptor.Call.html#withRequestSerializer-com.lightbend.lagom.javadsl.api.deser.MessageSerializer-"><code>withRequestSerializer</code></a> or <a href="api/index.html?com/lightbend/lagom/javadsl/api/Descriptor.Call.html#withResponseSerializer-com.lightbend.lagom.javadsl.api.deser.MessageSerializer-"><code>withResponseSerializer</code></a> calls.</p>
<p>This can be overridden when defining the service call in the descriptor:</p>
<pre class="prettyprint"><code class="language-java">default Descriptor descriptor() {
  return named(&quot;orderservice&quot;)
      .withCalls(
          pathCall(&quot;/orders/:id&quot;, this::getOrder)
              .withResponseSerializer(new MyOrderSerializer()));
}</code></pre><h3 id="Per-type-message-serializers"><a class="section-marker" href="#Per-type-message-serializers">§</a>Per type message serializers</h3>
<p>If no message serializer has been provided at the service call level, Lagom then checks whether a serializer has been registered at the service level for that type. Each service maintains a map of types to serializers for that type, and these are used as appropriate for service calls that match the types in the map.</p>
<p>Lagom provides a number of serializers out of the box at this level, including serializers for <code>String</code>, <code>Done</code>, <code>NotUsed</code> and <code>ByteString</code>. Note that serializer for <code>ByteString</code> doesn&rsquo;t modify data and sends <code>ByteString</code> as is. Custom type level serializers can also be supplied in the descriptor using the <a href="api/index.html?com/lightbend/lagom/javadsl/api/Descriptor.html#with-java.lang.reflect.Type-com.lightbend.lagom.javadsl.api.deser.MessageSerializer-"><code>Descriptor.with</code></a> method:</p>
<pre class="prettyprint"><code class="language-java">default Descriptor descriptor() {
  return named(&quot;orderservice&quot;)
      .withCalls(pathCall(&quot;/orders/:id&quot;, this::getOrder))
      .withMessageSerializer(Order.class, new MyOrderSerializer());
}</code></pre><h3 id="Serializer-factory"><a class="section-marker" href="#Serializer-factory">§</a>Serializer factory</h3>
<p>If neither a per service call nor per type message serializer has been found, Lagom will finally request its serializer factory for a serializer for a type. When using the defaults, this is the way Lagom will usually locate serializers for your types.</p>
<p>Lagom provides a <a href="api/index.html?com/lightbend/lagom/javadsl/api/deser/SerializerFactory.html"><code>SerializerFactory</code></a> interface for dynamically looking up and creating serializers for types. The default implementation provided by Lagom is a Jackson serializer factory, which serializes to/from JSON. You can customize which <code>SerializerFactory</code> is used by supplying it to the <a href="api/index.html?com/lightbend/lagom/javadsl/api/Descriptor.html#withMessageSerializer-java.lang.Class-com.lightbend.lagom.javadsl.api.deser.MessageSerializer-"><code>Descriptor.withMessageSerializer</code></a> method when declaring the signature:</p>
<pre class="prettyprint"><code class="language-java">default Descriptor descriptor() {
  return named(&quot;orderservice&quot;)
      .withCalls(pathCall(&quot;/orders/:id&quot;, this::getOrder))
      .withSerializerFactory(new MySerializerFactory());
}</code></pre><h2 id="Custom-serializers"><a class="section-marker" href="#Custom-serializers">§</a>Custom serializers</h2>
<p>Of course, being able to configure custom serializers is meaningless if you can&rsquo;t implement custom serializers. Lagom provides a <a href="api/index.html?com/lightbend/lagom/javadsl/api/deser/MessageSerializer.html"><code>MessageSerializer</code></a> interface that can be used to implement custom serializers.</p>
<p>As we&rsquo;ve <a href="ServiceDescriptors.html#Messages">already seen</a>, there are two types of messages in Lagom, strict messages and streamed messages. For these two types of messages, Lagom provides two sub interfaces of <code>MessageSerializer</code>, <a href="api/index.html?com/lightbend/lagom/javadsl/api/deser/StrictMessageSerializer.html"><code>StrictMessageSerializer</code></a> and <a href="api/index.html?com/lightbend/lagom/javadsl/api/deser/StreamedMessageSerializer.html"><code>StreamedMessageSerializer</code></a>, which differ primarily in the wire format that they serialize and deserialize to and from. Strict message serializers serialize and deserialize to and from <code>ByteString</code>, that is, they work strictly in memory, while streamed message serializers work with streams, that is, <code>Source&lt;ByteString, ?&gt;</code>.</p>
<p>Before we look into how to implement a serializer, there are a few basic concepts that need to be covered.</p><h3 id="Message-protocols"><a class="section-marker" href="#Message-protocols">§</a>Message protocols</h3>
<p>Lagom has a concept of message protocols. Message protocols are expressed using the <a href="api/index.html?com/lightbend/lagom/javadsl/api/transport/MessageProtocol.html"><code>MessageProtocol</code></a> type, and they have three properties, a content type, a character set, and a version. All of these properties are optional, and may or may not be used by a message serializer.</p>
<p>Message protocols translate roughly to HTTP <code>Content-Type</code> and <code>Accept</code> headers, with the version possibly being extracted from these if a mime type scheme that encodes the version is used, or possibly also been extracted from the URL, depending on how the service is configured.</p><h3 id="Content-negotiation"><a class="section-marker" href="#Content-negotiation">§</a>Content negotiation</h3>
<p>Lagom message serializers are able to use content negotiation to decide on the right protocol to use to talk to each other. This could be used to specify different wire formats, such as JSON and XML, as well as different versions.</p>
<p>Lagom&rsquo;s content negotiation mirrors the same capabilities as HTTP. For request messages, a client will select whatever protocol it wants to use, and so no negotiation is necessary there. The server then uses the message protocol sent by the client to decide how to deserialize the request.</p>
<p>For the response, the client sends a list of message protocols that it will accept, and the server should choose a protocol from that list to respond with. The client will then read the servers chosen protocol, and deserialize the response using that.</p><h3 id="Negotiated-serializers"><a class="section-marker" href="#Negotiated-serializers">§</a>Negotiated serializers</h3>
<p>As a consequence of content negotiation, Lagom&rsquo;s <code>MessageSerializer</code> doesn&rsquo;t directly serialize and deserialize messages, rather it provides methods for negotiating message protocols, which return a <a href="api/index.html?com/lightbend/lagom/javadsl/api/deser/MessageSerializer.NegotiatedSerializer.html"><code>NegotiatedSerializer</code></a> or <a href="api/index.html?com/lightbend/lagom/javadsl/api/deser/MessageSerializer.NegotiatedDeserializer.html"><code>NegotiatedDeserializer</code></a>. It is these negotiated classes that are actually responsible for doing the serializing and deserializing.</p>
<p>Let&rsquo;s take a look at an example of content negotiation. Let&rsquo;s say we wanted to implement a custom String <code>MessageSerializer</code>, that can serialize either to plain text, or to JSON, depending on what the client requests. This might be useful if you have some clients that send the text body as JSON, while others send it as plain text, perhaps one of the clients was a legacy client that did things one way, but now you want to do it the other with new clients.</p>
<p>Firstly, we&rsquo;ll implement the <code>NegotiatedSerializer</code> for plain text Strings:</p>
<pre class="prettyprint"><code class="language-java">public class PlainTextSerializer
    implements MessageSerializer.NegotiatedSerializer&lt;String, ByteString&gt; {
  private final String charset;

  public PlainTextSerializer(String charset) {
    this.charset = charset;
  }

  @Override
  public MessageProtocol protocol() {
    return new MessageProtocol(
        Optional.of(&quot;text/plain&quot;), Optional.of(charset), Optional.empty());
  }

  @Override
  public ByteString serialize(String s) throws SerializationException {
    return ByteString.fromString(s, charset);
  }
}</code></pre>
<p>The <code>protocol</code> method returns the protocol that this serializer serializes to, and you can see that we are passing the <code>charset</code> that this serializer will use in the constructor. The <code>serialize</code> method is a straight forward conversion from <code>String</code> to <code>ByteString</code>.</p>
<p>Next we&rsquo;ll implement the same thing but to serialize to JSON:</p>
<pre class="prettyprint"><code class="language-java">public class JsonTextSerializer
    implements MessageSerializer.NegotiatedSerializer&lt;String, ByteString&gt; {
  private final ObjectMapper mapper = new ObjectMapper();

  @Override
  public MessageProtocol protocol() {
    return new MessageProtocol(
        Optional.of(&quot;application/json&quot;), Optional.empty(), Optional.empty());
  }

  @Override
  public ByteString serialize(String s) throws SerializationException {
    try {
      return ByteString.fromArray(mapper.writeValueAsBytes(s));
    } catch (JsonProcessingException e) {
      throw new SerializationException(e);
    }
  }
}</code></pre>
<p>Here we&rsquo;re using Jackson to convert the <code>String</code> to a JSON string.</p>
<p>Now let&rsquo;s implement the plain text deserializer:</p>
<pre class="prettyprint"><code class="language-java">public class PlainTextDeserializer
    implements MessageSerializer.NegotiatedDeserializer&lt;String, ByteString&gt; {
  private final String charset;

  public PlainTextDeserializer(String charset) {
    this.charset = charset;
  }

  @Override
  public String deserialize(ByteString bytes) throws DeserializationException {
    return bytes.decodeString(charset);
  }
}</code></pre>
<p>Again, we&rsquo;re taking the <code>charset</code> as a constructor parameter and we have a straight forward conversion from <code>ByteString</code> to <code>String</code>.</p>
<p>Likewise, we have a JSON text deserializer:</p>
<pre class="prettyprint"><code class="language-java">public class JsonTextDeserializer
    implements MessageSerializer.NegotiatedDeserializer&lt;String, ByteString&gt; {
  private final ObjectMapper mapper = new ObjectMapper();

  @Override
  public String deserialize(ByteString bytes) throws DeserializationException {
    try {
      return mapper.readValue(bytes.iterator().asInputStream(), String.class);
    } catch (IOException e) {
      throw new DeserializationException(e);
    }
  }
}</code></pre>
<p>Now that we&rsquo;ve implemented our negotiated serializers and deserializers, it&rsquo;s time to implement the <code>MessageSerializer</code> to do the actual protocol negotiation. Our class will extend <code>StrictMessageSerializer</code>:</p>
<pre class="prettyprint"><code class="language-java">public class TextMessageSerializer implements StrictMessageSerializer&lt;String&gt; {</code></pre>
<p>The next thing we need to do is define the protocols that we accept. This will be used by the client to set the <code>Accept</code> header:</p>
<pre class="prettyprint"><code class="language-java">@Override
public PSequence&lt;MessageProtocol&gt; acceptResponseProtocols() {
  return TreePVector.from(
      Arrays.asList(
          new MessageProtocol().withContentType(&quot;text/plain&quot;),
          new MessageProtocol().withContentType(&quot;application/json&quot;)));
}</code></pre>
<p>You can see that this serializer supports both text and json protocols. One thing to note, we&rsquo;re not setting the charset in the text protocol, this is because we don&rsquo;t need to be specific about it, we can accept any charset that the server chooses.</p>
<p>Now let&rsquo;s implement the <code>serializerForRequest</code> method. This is used by the client to determine which serializer to use for the request. Because at this stage, no communication has happened between the server and the client, no negotiation can be done, so the client just chooses a default serializer, in this case, a <code>utf-8</code> plain text serializer:</p>
<pre class="prettyprint"><code class="language-java">@Override
public NegotiatedSerializer&lt;String, ByteString&gt; serializerForRequest() {
  return new PlainTextSerializer(&quot;utf-8&quot;);
}</code></pre>
<p>Next we&rsquo;ll implement the <code>deserializer</code> method. This is used both by the server to select the deserializer for the request, and the client to select deserializer for the response. The passed in <code>MessageProtocol</code> is the content type that was sent with the request or response, and we need to inspect it to see if it&rsquo;s a content type that we can deserialize, and return the appropriate content type:</p>
<pre class="prettyprint"><code class="language-java">@Override
public NegotiatedDeserializer&lt;String, ByteString&gt; deserializer(MessageProtocol protocol)
    throws UnsupportedMediaType {
  if (protocol.contentType().isPresent()) {
    if (protocol.contentType().get().equals(&quot;text/plain&quot;)) {
      return new PlainTextDeserializer(protocol.charset().orElse(&quot;utf-8&quot;));
    } else if (protocol.contentType().get().equals(&quot;application/json&quot;)) {
      return new JsonTextDeserializer();
    } else {
      throw new UnsupportedMediaType(
          protocol, new MessageProtocol().withContentType(&quot;text/plain&quot;));
    }
  } else {
    return new PlainTextDeserializer(&quot;utf-8&quot;);
  }
}</code></pre>
<p>Note that if no content type was specified, we&rsquo;re returning a default deserializer. We could also fail here by throwing an exception, but it&rsquo;s a good idea not to do that, because some underlying transports don&rsquo;t allow passing a content type with the message. For example, if this was used for a WebSocket request, web browsers don&rsquo;t allow you to set the content type for a WebSocket request. By returning a default if no content type is set, we ensure maximum portability.</p>
<p>Next we&rsquo;ll implement the <code>serializerForResponse</code> method. This takes the list of accepted protocols, as sent by the client, and selects one to use to serialize the response. If it can&rsquo;t find one that it supports, it throws an exception. Note here that an empty value for any property means that the client is willing to accept anything, likewise if the client didn&rsquo;t specify any accept protocols.</p>
<pre class="prettyprint"><code class="language-java">@Override
public NegotiatedSerializer&lt;String, ByteString&gt; serializerForResponse(
    List&lt;MessageProtocol&gt; acceptedMessageProtocols) throws NotAcceptable {
  if (acceptedMessageProtocols.isEmpty()) {
    return new PlainTextSerializer(&quot;utf-8&quot;);
  } else {
    for (MessageProtocol protocol : acceptedMessageProtocols) {
      if (protocol.contentType().isPresent()) {
        String contentType = protocol.contentType().get();
        if (contentType.equals(&quot;text/plain&quot;)
            || contentType.equals(&quot;text/*&quot;)
            || contentType.equals(&quot;*/*&quot;)) {
          return new PlainTextSerializer(protocol.charset().orElse(&quot;utf-8&quot;));
        } else if (protocol.contentType().get().equals(&quot;application/json&quot;)) {
          return new JsonTextSerializer();
        }
      } else {
        return new PlainTextSerializer(protocol.charset().orElse(&quot;utf-8&quot;));
      }
    }
    throw new NotAcceptable(
        acceptedMessageProtocols, new MessageProtocol().withContentType(&quot;text/plain&quot;));
  }
}</code></pre><h2 id="Custom-serializer-factories"><a class="section-marker" href="#Custom-serializer-factories">§</a>Custom serializer factories</h2>
<p>As explained before, by default Lagom provides a Jackson serializer factory, but allows you to override it. A serializer factory is responsible for, given a type, returning a <code>MessageSerializer</code> for that type if it can find one.</p>
<p>The <a href="#XML-serializers">XML serializers</a> example below shows an example of creating a custom serialization factory.</p><h2 id="Examples"><a class="section-marker" href="#Examples">§</a>Examples</h2><h3 id="Protocol-buffer-serializers"><a class="section-marker" href="#Protocol-buffer-serializers">§</a>Protocol buffer serializers</h3>
<p><a href="https://developers.google.com/protocol-buffers/">Protocol buffers</a> are a high performance language neutral alternative to JSON that are particularly a good choice for internal communication between services. Here&rsquo;s an example of how you might write a <code>MessageSerializer</code> for an <code>Order</code> class generated by <code>protoc</code>:</p>
<pre class="prettyprint"><code class="language-java">public class ProtobufSerializer implements StrictMessageSerializer&lt;Order&gt; {
  private final NegotiatedSerializer&lt;Order, ByteString&gt; serializer =
      new NegotiatedSerializer&lt;Order, ByteString&gt;() {
        @Override
        public MessageProtocol protocol() {
          return new MessageProtocol().withContentType(&quot;application/octet-stream&quot;);
        }

        @Override
        public ByteString serialize(Order order) throws SerializationException {
          ByteStringBuilder builder = ByteString.createBuilder();
          order.writeTo(builder.asOutputStream());
          return builder.result();
        }
      };
  private final NegotiatedDeserializer&lt;Order, ByteString&gt; deserializer =
      bytes -&gt; Order.parseFrom(bytes.iterator().asInputStream());

  @Override
  public NegotiatedSerializer&lt;Order, ByteString&gt; serializerForRequest() {
    return serializer;
  }

  @Override
  public NegotiatedDeserializer&lt;Order, ByteString&gt; deserializer(MessageProtocol protocol)
      throws UnsupportedMediaType {
    return deserializer;
  }

  @Override
  public NegotiatedSerializer&lt;Order, ByteString&gt; serializerForResponse(
      List&lt;MessageProtocol&gt; acceptedMessageProtocols) throws NotAcceptable {
    return serializer;
  }
}</code></pre>
<p>Note that this <code>MessageSerializer</code> doesn&rsquo;t attempt to do any content negotiation. In many cases, content negotiation is overkill, if you don&rsquo;t need it, you don&rsquo;t have to implement it.</p><h3 id="XML-serializers"><a class="section-marker" href="#XML-serializers">§</a>XML serializers</h3>
<p>Although XML is not recommended due to its size and slow performance, there may be situations where you may need to use it, for example when interfacing with legacy systems. Here&rsquo;s an example of a JAXB serializer factory:</p>
<pre class="prettyprint"><code class="language-java">public class JaxbSerializerFactory implements SerializerFactory {
  private final Unmarshaller unmarshaller;
  private final Marshaller marshaller;

  public JaxbSerializerFactory() {
    try {
      JAXBContext context = JAXBContext.newInstance();
      this.unmarshaller = context.createUnmarshaller();
      this.marshaller = context.createMarshaller();
    } catch (JAXBException e) {
      throw new RuntimeException(e);
    }
  }

  @Override
  @SuppressWarnings(&quot;unchecked&quot;)
  public &lt;MessageEntity&gt; MessageSerializer&lt;MessageEntity, ?&gt; messageSerializerFor(Type type) {
    if (type instanceof Class) {
      Class&lt;MessageEntity&gt; clazz = (Class&lt;MessageEntity&gt;) type;

      return new StrictMessageSerializer&lt;MessageEntity&gt;() {

        NegotiatedSerializer&lt;MessageEntity, ByteString&gt; serializer =
            new NegotiatedSerializer&lt;MessageEntity, ByteString&gt;() {
              @Override
              public MessageProtocol protocol() {
                return new MessageProtocol().withContentType(&quot;application/xml&quot;);
              }

              @Override
              public ByteString serialize(MessageEntity messageEntity)
                  throws SerializationException {
                ByteStringBuilder builder = ByteString.createBuilder();
                try {
                  marshaller.marshal(messageEntity, builder.asOutputStream());
                  return builder.result();
                } catch (JAXBException e) {
                  throw new SerializationException(e);
                }
              }
            };

        NegotiatedDeserializer&lt;MessageEntity, ByteString&gt; deserializer =
            bytes -&gt; {
              try {
                return unmarshaller
                    .unmarshal(new StreamSource(bytes.iterator().asInputStream()), clazz)
                    .getValue();
              } catch (JAXBException e) {
                throw new DeserializationException(e);
              }
            };

        @Override
        public NegotiatedSerializer&lt;MessageEntity, ByteString&gt; serializerForRequest() {
          return serializer;
        }

        @Override
        public NegotiatedDeserializer&lt;MessageEntity, ByteString&gt; deserializer(
            MessageProtocol protocol) throws UnsupportedMediaType {
          return deserializer;
        }

        @Override
        public NegotiatedSerializer&lt;MessageEntity, ByteString&gt; serializerForResponse(
            List&lt;MessageProtocol&gt; acceptedMessageProtocols) throws NotAcceptable {
          return serializer;
        }
      };
    } else {
      throw new IllegalArgumentException(&quot;JAXB does not support deserializing generic types&quot;);
    }
  }
}</code></pre>
                </article>

                
                    
                        
                            <nav class="next-link">
                                <a href="HeaderFilters.html"><strong>Next: </strong>
                                    Header Filters</a>
                            </nav>
                        
                    
                

                
                    <p class="edit-source">Found an error in this documentation? The source code for this page can be found
                        <a href="https://github.com/lagom/lagom/edit/1.6.x/docs/manual/java/guide/services/MessageSerializers.md">here</a>. Please feel free to edit and contribute a pull request. </p>
                
            </div>
            <aside class="small-12 large-4 columns">
                <nav class="side-menu">

                    <input type="search" id="cross-docs-search" placeholder="Search..." />

                    <label for="docs-version">Version:</label>
                    <select id="docs-version">
                    
                        <option value="/documentation/1.0.x/java/MessageSerializers.html" >1.0.x</option>
                    
                        <option value="/documentation/1.1.x/java/MessageSerializers.html" >1.1.x</option>
                    
                        <option value="/documentation/1.2.x/java/MessageSerializers.html" >1.2.x</option>
                    
                        <option value="/documentation/1.3.x/java/MessageSerializers.html" >1.3.x</option>
                    
                        <option value="/documentation/1.4.x/java/MessageSerializers.html" >1.4.x</option>
                    
                        <option value="/documentation/1.5.x/java/MessageSerializers.html" >1.5.x</option>
                    
                        <option value="/documentation/1.6.x/java/MessageSerializers.html" >1.6.x</option>
                    
                        <option value="/documentation/current/java/MessageSerializers.html" 
                            selected="selected">current</option>
                    
                        <option value="/documentation/latest/java/MessageSerializers.html" >latest</option>
                    
                    </select>

                    <a href="/documentation/current/java/api/index.html" class="api-docs">
                        API Documentation</a>

                    
                        <h3>Writing Lagom services</h3>
                        <ul>
                        
                            
                                <li><a href="ServiceDescriptors.html">Service descriptors</a></li>
                            
                        
                            
                                <li><a href="ServiceImplementation.html">Implementing services</a></li>
                            
                        
                            
                                <li><a href="ServiceInfo.html">Service Metadata</a></li>
                            
                        
                            
                                <li><a href="ServiceClients.html">Consuming services</a></li>
                            
                        
                            
                                <li><a href="Test.html">Testing Services</a></li>
                            
                        
                            
                                <li class="current-page"><a href="MessageSerializers.html">Message serializers</a></li>
                            
                        
                            
                                <li><a href="HeaderFilters.html">Header Filters</a></li>
                            
                        
                            
                                <li><a href="ServiceErrorHandling.html">Error handling</a></li>
                            
                        
                            
                                <li><a href="AdditionalRouters.html">Additional Routers</a></li>
                            
                        
                        </ul>
                    
                        <h3>Lagom reference guide</h3>
                        <ul>
                        
                            
                                <li><a href="ReferenceGuide.html">Reference Guide</a></li>
                            
                        
                            
                                <li><a href="LagomBuild.html">Configuring builds and the development environment</a></li>
                            
                        
                            
                                <li><a href="DevEnvironment.html">Running Lagom in development</a></li>
                            
                        
                            
                                <li class="current-page"><a href="ServiceDescriptors.html">Writing Lagom services</a></li>
                            
                        
                            
                                <li><a href="UsingAkkaPersistenceTyped.html">Writing persistent and clustered services</a></li>
                            
                        
                            
                                <li><a href="MessageBroker.html">Decouple services with a message broker</a></li>
                            
                        
                            
                                <li><a href="ProductionOverview.html">Running Lagom in production</a></li>
                            
                        
                            
                                <li><a href="Logging.html">Logging</a></li>
                            
                        
                            
                                <li><a href="Akka.html">Advanced topics</a></li>
                            
                        
                        </ul>
                    
                        <h3>Java Home</h3>
                        <ul>
                        
                            
                                <li><a href="Home.html">Home</a></li>
                            
                        
                            
                                <li><a href="WhatIsLagom.html">Welcome to Lagom</a></li>
                            
                        
                            
                                <li><a href="IntroGetStarted.html">Getting started with Lagom</a></li>
                            
                        
                            
                                <li><a href="CoreConcepts.html">Lagom core concepts</a></li>
                            
                        
                            
                                <li class="current-page"><a href="ReferenceGuide.html">Lagom reference guide</a></li>
                            
                        
                            
                                <li><a href="Highlights16.html">Lagom releases</a></li>
                            
                        
                        </ul>
                    
                </nav>
            </aside>
        </div>
    </div>


                    <footer>
                        <section class="fw-wrapper lb-grey-dkr support">
                            <div class="row">
                                <div class="small-12 medium-6 columns">
                                    <svg class="svg-icon svg-icon-chat" version="1.1" id="Chat" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 20 20" style="enable-background:new 0 0 20 20;" xml:space="preserve">
<path fill="#ffffff" d="M5.8,12.2V6H2C0.9,6,0,6.9,0,8v6c0,1.1,0.9,2,2,2h1v3l3-3h5c1.1,0,2-0.9,2-2v-1.82c-0.064,0.014-0.132,0.021-0.2,0.021h-7
	V12.2z M18,1H9C7.9,1,7,1.9,7,3v8h7l3,3v-3h1c1.1,0,2-0.899,2-2V3C20,1.9,19.1,1,18,1z"/>
</svg>

                                    <h3>Community support</h3>
                                    <ul>
                                        <li><a href="https://discuss.lagomframework.com">Discuss Lagom</a></li>
                                        <li><a href="https://stackoverflow.com/questions/tagged/lagom">Stack Overflow</a></li>
                                    </ul>
                                </div>
                                <div class="small-12 medium-6 columns">
                                    <svg class="svg-icon svg-icon-lb-icon-reverse" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 302 262">
    <title>lightbend-icon</title>
    <path  fill="#ffffff" d="M1,195v56a10,10,0,0,0,10,10H291a10,10,0,0,0,10-10V195a557.85,557.85,0,0,1-150,20A557.85,557.85,0,0,1,1,195Z" />
    <path  fill="#ffffff" d="M291,1H11A10,10,0,0,0,1,11V176a539.94,539.94,0,0,0,150,21,539.94,539.94,0,0,0,150-21V11A10,10,0,0,0,291,1Z" />
</svg>

                                    <h3>Professional support</h3>
                                    <ul>
                                        <li><a href="https://www.lightbend.com/services/expert-support">Lightbend Subscription</a></li>
                                        <li><a href="https://www.lightbend.com/services/training">Training</a></li>
                                        <li><a href="https://www.lightbend.com/services/consulting">Consulting</a></li>
                                    </ul>
                                </div>
                            </div>
                        </section>

                        <section class="fw-wrapper lb-grey links">
                            <div class="row">
                                <div class="small-12 medium-6 large-3 columns">
                                    <h3>Lagom</h3>
                                    <ul class="no-bullet">
                                        <li><a href="/get-started.html">Try Lagom</a></li>
                                        <li><a href="/blog">Blog</a></li>
                                        <li><a href="/documentation/">Documentation</a></li>
                                        <li><a href="/faq">FAQ</a></li>
                                        <li><a href="/support">Support</a></li>
                                    </ul>
                                </div>
                                <div class="small-12 medium-6 large-3 columns">
                                    <h3>Community links</h3>
                                    <ul>
                                        <li><a href="https://www.eventbrite.com/directory/?q=lagom&amp;loc=Worldwide">Events <em>via Eventbrite</em></a></li>
                                        <li><a href="http://www.indeed.com/jobs?q=%22lagom%22&amp;l=">Jobs <em>via Indeed</em></a></li>
                                    </ul>
                                </div>
                                <div class="small-12 medium-6 large-3 columns">
                                    <h3>Code &amp; contribution</h3>
                                    <ul>
                                        <li><a href="https://github.com/lagom/lagom/issues">Bug tracker <em>GitHub</em></a></li>
                                        <li><a href="/get-involved.html">Get involved</a></li>
                                    </ul>
                                </div>
                                <div class="small-12 medium-6 large-3 columns">
                                    <h3>Social networks</h3>
                                    <ul>
                                        <li><a href="https://twitter.com/lagom"><span>Twitter</span></a></li>
                                    </ul>
                                </div>
                            </div>
                        </section>

                        <section class="fw-wrapper lgm-purple-dkr credits">
                            <div class="row">
                                <div class="small-12 medium-3 columns">
                                    <a href="/" class="logo"><img src="/images/logos/lagom-reverse.svg"></a>
                                </div>
                                <div class="small-12 medium-3 columns">
                                    <a href="https://www.lightbend.com" class="partner"><img src="/images/logos/lightbend-reverse.svg"></a>
                                </div>
                                <div class="small-12 medium-6 columns">
                                    <p>Lagom is released under the Apache 2 License</p>
                                </div>
                            </div>
                            <div class="row lb-legal">
                                <div class="small-12 columns">
                                    <p>
                                        &copy; Lightbend 2018 | 
                                        <a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> | 
                                        <a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> | 
                                        <a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | 
                                        <a href="/cookie.html">Cookie Listing</a> | 
                                        <a class="optanon-toggle-display">Cookie Settings</a>
                                    </p>
                                </div>
                            </div>
                        </section>

                    </footer>

                </div>
            </div>
        </div>
    </body>
    <script src="/94dac49075b4ec3a86dd12848be6c2286ed80149-all-scripts-concat.js"></script>
    
     
    <script type="text/javascript" src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
        <!-- Cross-site search. This is using Algolia's autocomplete.js  -->
    <script>
            var clientLagom = algoliasearch('BH4D9OD16A', '77ef1e29e6bddfca861f7a42cc51725e');
            var lagomIndex = clientLagom.initIndex('lagomframework');

            var displayValue = function (suggestion, level) {
                if (level === 0)
                    return suggestion._highlightResult.hierarchy.lvl0.value;
                if (suggestion._highlightResult.hierarchy['lvl' + level] !== undefined) {
                    return suggestion._highlightResult.hierarchy['lvl' + level].value ;
                } else {
                    return displayValue(suggestion, level - 1) ;
                }
            };
            var displaySnippet = function (suggestion) {
                if (typeof suggestion._snippetResult !== 'undefined') {
                    return '<div class="algolia-docsearch-suggestion--text">' + suggestion._snippetResult.content.value + '</div>'
                } else {
                    return ''
                }
            }

            var wrap = function (content, wrapper) {
                if (typeof wrapper !== 'undefined') {
                    return '<span class=' + wrapper + '>' + content + '</span>';
                } else {
                    return content;
                }
            }

            var buildIndexSettings = function (_indexObj, _hitsPerPage, _faceFilters, title, useFooter, wrapper) {
                var _header = wrap('<span class="algolia-docsearch-suggestion algolia-docsearch-suggestion__main algolia-docsearch-suggestion__secondary algolia-docsearch-suggestion--category-header ">' + title + '</span>', wrapper);
                var _templates = {
                    header: _header,
                    suggestion: function (suggestion) {
                        var suggestionHtml = '<div class="algolia-docsearch-suggestion algolia-docsearch-suggestion__secondary" style="white-space: normal;">' +
                                '<div class="algolia-docsearch-suggestion--wrapper">' +
                                '<div class="algolia-docsearch-suggestion--subcategory-column ">' +
                                '<span class="algolia-docsearch-suggestion--subcategory-column-text">' + displayValue(suggestion, 0) + '</span>' +
                                '</div>' +
                                '<div class="algolia-docsearch-suggestion--content">' +
                                '<div class="algolia-docsearch-suggestion--subcategory-inline ">' + displayValue(suggestion, 1) + '</div>' +
                                '<div class="algolia-docsearch-suggestion--title algolia-docsearch-suggestion--duplicate-content">' + displayValue(suggestion, 2) + '</div>' +
                                displaySnippet(suggestion) +
                                '</div>' +
                                '</div>' +
                                '</div>';
                        return wrap(suggestionHtml, wrapper)
                    }
                };
                if (useFooter) {
                    _templates['footer'] = '<div class="algolia-docsearch-footer"><a class="algolia-docsearch-footer--logo" href="https://www.algolia.com/docsearch">Algolia</a></div>';
                }

                return {
                    source: autocomplete.sources.hits(
                            _indexObj,
                            {hitsPerPage: _hitsPerPage, facetFilters: _faceFilters}
                    )
                    ,
                    templates: _templates
                };

            };

            var lagomFacetFilters = ['version:current'];

            var useScalaFacetFilter = window.location.href.split('/').includes("scala");
            if (useScalaFacetFilter) {
                lagomFacetFilters.push('language:scala');
            } else {
                lagomFacetFilters.push('language:java');
            }


            autocomplete('#cross-docs-search',
                    {hint: false},
                    [
                        buildIndexSettings(lagomIndex, 10, lagomFacetFilters, "Lagom Documentation", false)
                    ]
            ).on('autocomplete:selected', function (event, suggestion, dataset) {
                location.href = suggestion.url;
            });
    </script>


    

    <script type="text/plain" class="optanon-category-2">
  		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  		ga('create', 'UA-84991267-1', 'auto');
  		ga('send', 'pageview');

        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-MT586J3');
	</script>
</html>

