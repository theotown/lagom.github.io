<h1 id="Using-Akka-Discovery"><a class="section-marker" href="#Using-Akka-Discovery">ยง</a>Using Akka Discovery</h1>
<p>As of version 1.5.1, Lagom has built-in integration with <a href="https://doc.akka.io/docs/akka/2.5/discovery/index.html">Akka Discovery</a> throught a <a href="api/index.html?com/lightbend/lagom/javadsl/api/ServiceLocator.html">ServiceLocator</a> that wraps Akka Discovery. This is the recommended implementation for production specially for users targeting Kubernetes and DC/OS (Marathon).</p><h2 id="Dependency"><a class="section-marker" href="#Dependency">ยง</a>Dependency</h2>
<p>To use this feature add the following in your project&rsquo;s build:</p>
<p>In Maven:</p>
<pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;com.lightbend.lagom&lt;/groupId&gt;
    &lt;artifactId&gt;lagom-javadsl-akka-discovery-service-locator_${scala.binary.version}&lt;/artifactId&gt;
    &lt;version&gt;${lagom.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>In sbt:</p>
<pre class="prettyprint"><code class="language-sbt">libraryDependencies += lagomJavadslAkkaDiscovery</code></pre><h2 id="Configuration"><a class="section-marker" href="#Configuration">ยง</a>Configuration</h2>
<p>The Guice module <a href="api/index.html?com/lightbend/lagom/javadsl/akka/discovery/AkkaDiscoveryServiceLocatorModule.html">AkkaDiscoveryServiceLocatorModule</a> will be added by default to your project, but will only wire in the <a href="api/index.html?com/lightbend/lagom/javadsl/akka/discovery/AkkaDiscoveryServiceLocator.html">AkkaDiscoveryServiceLocator</a> when running in production mode.</p>
<p>In development, your Lagom application will keep using the Lagom&rsquo;s dev-mode <a href="api/index.html?com/lightbend/lagom/javadsl/api/ServiceLocator.html">ServiceLocator</a>.</p>
<p>By default, Lagom uses <a href="https://doc.akka.io/docs/akka/2.5/discovery/index.html#discovery-method-aggregate-multiple-discovery-methods">Aggregate multiple discovery methods</a>. The first discovery method is set to Configuration and the second is set to DNS.<br/>So the static definition of service endpoins has a priority over DNS discovery.</p>
<p>To statically configure service endpoints in your <code>application.conf</code> file consult the <a href="https://doc.akka.io/docs/akka/2.5/discovery/index.html#discovery-method-aggregate-multiple-discovery-methods">Aggregate multiple discovery methods</a> documentation.</p>
<p>To configure service discovery with DNS Lagom provides some configuration settings. The default settings are in</p>
<pre class="prettyprint"><code class="language-conf">lagom.akka.discovery {

  # When the service lookup regex fails, the defaults are used for the port and protocol.
  defaults {

    # The default port name. Blank if no port name should be added by default.
    port-name = http

    # The default port protocol. Blank if no port protocol should be added by default.
    port-protocol = tcp

    # The default scheme to use in returned URIs if not defined in the port-name-scheme-mappings.
    scheme = http
  }

  # A mapping of service names to lookup information. Each mapping should define the following:
  #
  # - lookup - An alternative name for the service. This can be configured with a simple name or a SRV lookup, for exampe:
  #   * my-service (simple name)
  #   * my-service.default.svc.cluster.local (simple fully-qualified name)
  #   * _http._tcp.my-service (SRV)
  #   * _http._tcp.my-service.default.svc.cluster.local (fully-qualified SRV)
  # - scheme - The scheme to return in the URI. If undefined, it will use the default scheme lagom.akka.discover.defaults.scheme.
  #
  # For example:
  # service-name-mappings {
  #   my-service-name {
  #     lookup = my-service.default.svc.cluster.local
  #     scheme = http
  #   }
  # }
  service-name-mappings {
  }


  # The timeout for a successful lookup.
  lookup-timeout = 5 seconds
}</code></pre>
<p>Note: this component was <a href="https://github.com/lagom/lagom-akka-discovery-service-locator">previous published</a> as an independent library. If you have it on your classpath it&rsquo;s recommended to remove it and use the one being provided by Lagom directly.</p>